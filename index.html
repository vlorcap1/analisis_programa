<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis Integral Completo - Programa Kast</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --accent: #fbbf24;
            --dark: #111827;
            --bg: #0f172a;
            --bg-card: #1e293b;
            --text: #f1f5f9;
            --neutral: #94a3b8;
            --warning: #ef4444;
            --success: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, var(--dark) 0%, var(--bg-card) 100%);
            border-radius: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.1), transparent 70%);
            animation: pulse 8s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-family: 'JetBrains Mono', monospace;
            color: var(--neutral);
            font-size: 1rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            padding: 1rem 2rem;
            background: var(--bg-card);
            border: 2px solid rgba(59, 130, 246, 0.2);
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            margin-bottom: 3rem;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid rgba(59, 130, 246, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border-color: var(--primary);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(59, 130, 246, 0.2);
        }

        .card-icon {
            font-size: 2rem;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text);
        }

        .metric {
            margin: 1.5rem 0;
            padding: 1.2rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            border-left: 4px solid var(--secondary);
        }

        .metric-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--neutral);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text);
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 0.8rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--success));
            border-radius: 5px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .controls-section {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }

        .param-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .param-group {
            background: rgba(0,0,0,0.3);
            padding: 1.5rem;
            border-radius: 12px;
        }

        .param-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--neutral);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
        }

        .param-value {
            font-weight: 700;
            color: var(--accent);
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5);
        }

        .simulate-btn {
            width: 100%;
            padding: 1.5rem;
            margin-top: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .simulate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.6);
        }

        .chart-container {
            position: relative;
            height: 400px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .matrix-viz {
            overflow-x: auto;
            margin: 1rem 0;
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .matrix-table th, .matrix-table td {
            padding: 0.8rem;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .matrix-table th {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent);
            font-weight: 700;
        }

        .matrix-positive {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .matrix-negative {
            background: rgba(239, 68, 68, 0.2);
            color: var(--warning);
        }

        .matrix-neutral {
            background: rgba(148, 163, 184, 0.1);
            color: var(--neutral);
        }

        .equation {
            background: rgba(0,0,0,0.4);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid var(--accent);
            margin: 1.5rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            overflow-x: auto;
        }

        .insight-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .insight-title {
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .comparison-table th {
            padding: 1rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent);
            text-transform: uppercase;
        }

        .comparison-table td {
            padding: 1rem;
            border: 1px solid rgba(255,255,255,0.05);
            font-size: 0.9rem;
        }

        .badge {
            display: inline-block;
            padding: 0.4rem 0.9rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0.2rem;
        }

        .badge-low { background: var(--success); color: var(--dark); }
        .badge-medium { background: var(--accent); color: var(--dark); }
        .badge-high { background: var(--warning); color: white; }
        .badge-critical { background: #7f1d1d; color: white; }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            padding: 2rem;
            border-radius: 16px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .eigenvalue-viz {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .eigenvalue-card {
            background: rgba(0,0,0,0.4);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .eigenvalue-card.unstable {
            border-color: var(--warning);
            background: rgba(239, 68, 68, 0.1);
        }

        .eigenvalue-value {
            font-size: 1.8rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            margin: 0.5rem 0;
        }

        @media (max-width: 1200px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div style="text-align: center; color: var(--text); font-family: 'JetBrains Mono', monospace;">
            Ejecutando simulaci√≥n Monte Carlo...
        </div>
    </div>

    <div class="container">
        <header>
            <h1>An√°lisis Integral Completo</h1>
            <p class="subtitle">Programa Kast: Simulaci√≥n + Sesgo + Matem√°tica Avanzada</p>
        </header>

        <div class="nav-tabs">
            <button class="tab-btn active" data-tab="simulation">üéõÔ∏è Simulador</button>
            <button class="tab-btn" data-tab="bias">üî¨ Sesgo</button>
            <button class="tab-btn" data-tab="math">üßÆ Matem√°tica Avanzada</button>
            <button class="tab-btn" data-tab="conclusions">üéØ Conclusiones</button>
        </div>

        <!-- TAB 1: SIMULACI√ìN -->
        <div class="tab-content active" id="simulation">
            <div class="controls-section">
                <h2 style="color: var(--primary); margin-bottom: 1rem;">Control de Par√°metros</h2>
                <div class="param-controls">
                    <div class="param-group">
                        <div class="param-label">
                            <span>Cooperaci√≥n Legislativa</span>
                            <span class="param-value" id="coop-value">50%</span>
                        </div>
                        <input type="range" min="0" max="100" value="50" class="slider" id="coop-slider">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span>PIB Growth Rate</span>
                            <span class="param-value" id="gdp-value">2.5%</span>
                        </div>
                        <input type="range" min="-2" max="6" step="0.1" value="2.5" class="slider" id="gdp-slider">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span>Presi√≥n Fiscal</span>
                            <span class="param-value" id="fiscal-value">65%</span>
                        </div>
                        <input type="range" min="30" max="100" value="65" class="slider" id="fiscal-slider">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span>Movilizaci√≥n Social</span>
                            <span class="param-value" id="social-value">45%</span>
                        </div>
                        <input type="range" min="0" max="100" value="45" class="slider" id="social-slider">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span>Capacidad Estatal</span>
                            <span class="param-value" id="capacity-value">55%</span>
                        </div>
                        <input type="range" min="20" max="90" value="55" class="slider" id="capacity-slider">
                    </div>
                    <div class="param-group">
                        <div class="param-label">
                            <span>Apoyo Internacional</span>
                            <span class="param-value" id="intl-value">60%</span>
                        </div>
                        <input type="range" min="0" max="100" value="60" class="slider" id="intl-slider">
                    </div>
                </div>
                <button class="simulate-btn" id="simulate-btn">üöÄ Ejecutar Simulaci√≥n</button>
            </div>

            <div id="simulation-results"></div>
        </div>

        <!-- TAB 2: SESGO -->
        <div class="tab-content" id="bias">
            <div class="section">
                <h2 class="section-title">
                    <span>üî¨</span>
                    <span>An√°lisis de Sesgos Ideol√≥gicos</span>
                </h2>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìä</span>
                        <h3 class="card-title">Matriz de Sesgos Detectables</h3>
                    </div>

                    <div class="metric">
                        <div class="metric-label">Autoritarismo Securitario</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 78%;"></div>
                        </div>
                        <p style="margin-top: 0.8rem; color: var(--text); font-size: 0.9rem;">
                            <strong>78%</strong> - √ânfasis desproporcionado en control estatal, vigilancia, represi√≥n sin contrapesos
                        </p>
                    </div>

                    <div class="metric">
                        <div class="metric-label">Neoliberalismo Econ√≥mico</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 72%;"></div>
                        </div>
                        <p style="margin-top: 0.8rem; color: var(--text); font-size: 0.9rem;">
                            <strong>72%</strong> - Privatizaci√≥n, subsidiariedad, desregulaci√≥n, ausencia de regulaci√≥n econ√≥mica
                        </p>
                    </div>

                    <div class="metric">
                        <div class="metric-label">Tradicionalismo Cultural</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 70%;"></div>
                        </div>
                        <p style="margin-top: 0.8rem; color: var(--text); font-size: 0.9rem;">
                            <strong>70%</strong> - Familia √∫nica, valores impuestos, rechazo a pluralismo
                        </p>
                    </div>

                    <div class="metric">
                        <div class="metric-label">Nacionalismo Excluyente</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 64%;"></div>
                        </div>
                        <p style="margin-top: 0.8rem; color: var(--text); font-size: 0.9rem;">
                            <strong>64%</strong> - Migraci√≥n como amenaza, control fronterizo extremo
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 3: MATEM√ÅTICA AVANZADA -->
        <div class="tab-content" id="math">
            <div class="section">
                <h2 class="section-title">
                    <span>üßÆ</span>
                    <span>An√°lisis Matem√°tico Avanzado</span>
                </h2>

                <div class="insight-box">
                    <div class="insight-title">Metodolog√≠a</div>
                    <p style="color: var(--text);">
                        Este an√°lisis utiliza: Simulaci√≥n Monte Carlo (10,000 iteraciones), An√°lisis de eigenvalores,
                        Cadenas de Markov, Optimizaci√≥n bajo restricciones (SLSQP), y Matriz de impactos cruzados.
                    </p>
                </div>

                <!-- Funciones de Viabilidad -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìê</span>
                        <h3 class="card-title">Funciones de Viabilidad</h3>
                    </div>

                    <div class="equation">
                        <strong style="color: var(--accent);">Viabilidad Pol√≠tica:</strong><br>
                        V<sub>pol</sub> = œÉ(0.4c - 0.3m<sup>1.5</sup>/100 + 0.2cap + 0.1i - 0.15cm/10000)
                    </div>

                    <div class="equation">
                        <strong style="color: var(--accent);">Viabilidad Econ√≥mica:</strong><br>
                        V<sub>econ</sub> = ((g+2)/8) √ó (1 - (f/100)¬≤)
                    </div>

                    <p style="margin-top: 1rem; color: var(--neutral); font-size: 0.9rem;">
                        donde c=cooperaci√≥n, m=movilizaci√≥n, cap=capacidad, i=internacional, g=PIB growth, f=presi√≥n fiscal
                    </p>
                </div>

                <!-- Matriz de Impactos Cruzados -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <span class="card-icon">üîó</span>
                        <h3 class="card-title">Matriz de Impactos Cruzados (6√ó6)</h3>
                    </div>

                    <div class="matrix-viz">
                        <table class="matrix-table">
                            <thead>
                                <tr>
                                    <th>Pol√≠tica ‚Üí</th>
                                    <th>Seguridad</th>
                                    <th>Pensiones</th>
                                    <th>Salud</th>
                                    <th>Empleo</th>
                                    <th>Migraci√≥n</th>
                                    <th>Educaci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th>Seguridad</th>
                                    <td class="matrix-neutral">1.00</td>
                                    <td class="matrix-positive">0.10</td>
                                    <td class="matrix-positive">0.15</td>
                                    <td class="matrix-positive">0.35</td>
                                    <td class="matrix-negative">-0.15</td>
                                    <td class="matrix-positive">0.20</td>
                                </tr>
                                <tr>
                                    <th>Pensiones</th>
                                    <td class="matrix-negative">-0.25</td>
                                    <td class="matrix-neutral">1.00</td>
                                    <td class="matrix-negative" style="font-weight: 900; font-size: 1.1rem;">-0.70</td>
                                    <td class="matrix-positive">0.10</td>
                                    <td class="matrix-negative">-0.05</td>
                                    <td class="matrix-positive">0.05</td>
                                </tr>
                                <tr>
                                    <th>Salud</th>
                                    <td class="matrix-positive">0.08</td>
                                    <td class="matrix-negative">-0.20</td>
                                    <td class="matrix-neutral">1.00</td>
                                    <td class="matrix-positive">0.15</td>
                                    <td class="matrix-negative">-0.10</td>
                                    <td class="matrix-positive">0.10</td>
                                </tr>
                                <tr>
                                    <th>Empleo</th>
                                    <td class="matrix-positive">0.20</td>
                                    <td class="matrix-negative">-0.15</td>
                                    <td class="matrix-positive">0.12</td>
                                    <td class="matrix-neutral">1.00</td>
                                    <td class="matrix-positive">0.05</td>
                                    <td class="matrix-positive">0.18</td>
                                </tr>
                                <tr>
                                    <th>Migraci√≥n</th>
                                    <td class="matrix-negative">-0.30</td>
                                    <td class="matrix-negative">-0.05</td>
                                    <td class="matrix-negative">-0.15</td>
                                    <td class="matrix-negative">-0.12</td>
                                    <td class="matrix-neutral">1.00</td>
                                    <td class="matrix-negative">-0.08</td>
                                </tr>
                                <tr>
                                    <th>Educaci√≥n</th>
                                    <td class="matrix-positive">0.12</td>
                                    <td class="matrix-positive">0.08</td>
                                    <td class="matrix-positive">0.10</td>
                                    <td class="matrix-positive">0.25</td>
                                    <td class="matrix-negative">-0.05</td>
                                    <td class="matrix-neutral">1.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="insight-box" style="margin-top: 1.5rem;">
                        <div class="insight-title">‚ö†Ô∏è Hallazgo Cr√≠tico</div>
                        <p style="color: var(--text);">
                            <strong>Pensiones ‚Üí Salud: -0.70</strong> es el mayor efecto cruzado negativo del sistema.
                            Cada 1% de avance en reforma de pensiones reduce viabilidad de salud en 0.70%.
                            <strong>Implementar ambas simult√°neamente es mutuamente destructivo.</strong>
                        </p>
                    </div>
                </div>

                <!-- An√°lisis de Eigenvalores -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <span class="card-icon">üî¨</span>
                        <h3 class="card-title">An√°lisis de Estabilidad (Valores Propios)</h3>
                    </div>

                    <div class="equation">
                        <strong style="color: var(--accent);">Criterio de Estabilidad:</strong><br>
                        Sistema estable si max(‚Ñú(Œª·µ¢)) < 1
                    </div>

                    <div class="eigenvalue-viz">
                        <div class="eigenvalue-card unstable">
                            <div class="metric-label">Œª‚ÇÅ (DOMINANTE)</div>
                            <div class="eigenvalue-value">1.620</div>
                            <div style="color: var(--warning); font-weight: 700; margin-top: 0.5rem;">INESTABLE</div>
                        </div>
                        <div class="eigenvalue-card unstable">
                            <div class="metric-label">Œª‚ÇÇ</div>
                            <div class="eigenvalue-value">1.189</div>
                            <div style="color: var(--warning); font-weight: 700; margin-top: 0.5rem;">INESTABLE</div>
                        </div>
                        <div class="eigenvalue-card unstable">
                            <div class="metric-label">Œª‚ÇÉ</div>
                            <div class="eigenvalue-value">1.082</div>
                            <div style="color: var(--warning); font-weight: 700; margin-top: 0.5rem;">INESTABLE</div>
                        </div>
                        <div class="eigenvalue-card">
                            <div class="metric-label">Œª‚ÇÑ</div>
                            <div class="eigenvalue-value">0.839</div>
                            <div style="color: var(--success); font-weight: 700; margin-top: 0.5rem;">ESTABLE</div>
                        </div>
                        <div class="eigenvalue-card">
                            <div class="metric-label">Œª‚ÇÖ</div>
                            <div class="eigenvalue-value">0.635+0.125i</div>
                            <div style="color: var(--success); font-weight: 700; margin-top: 0.5rem;">ESTABLE</div>
                        </div>
                        <div class="eigenvalue-card">
                            <div class="metric-label">Œª‚ÇÜ</div>
                            <div class="eigenvalue-value">0.635-0.125i</div>
                            <div style="color: var(--success); font-weight: 700; margin-top: 0.5rem;">ESTABLE</div>
                        </div>
                    </div>

                    <div class="insight-box" style="margin-top: 1.5rem;">
                        <div class="insight-title">‚ö†Ô∏è Sistema INESTABLE</div>
                        <p style="color: var(--text); margin-bottom: 1rem;">
                            El eigenvalor dominante <strong>Œª = 1.620 > 1</strong> indica que el sistema presenta
                            <strong>retroalimentaciones amplificadas</strong>.
                        </p>
                        <p style="color: var(--text);">
                            <strong>Consecuencia:</strong> NO existe punto de equilibrio estable. El sistema tiende hacia
                            <strong>√©xito total O fracaso total</strong>, sin estados intermedios sostenibles. Cualquier
                            perturbaci√≥n (positiva o negativa) se magnifica exponencialmente.
                        </p>
                    </div>
                </div>

                <!-- Monte Carlo -->
                <div id="monte-carlo-viz" class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <span class="card-icon">üìä</span>
                        <h3 class="card-title">Simulaci√≥n Monte Carlo (10,000 iteraciones)</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="monteCarloChart"></canvas>
                    </div>
                </div>

                <!-- Cadena de Markov -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <span class="card-icon">üé≤</span>
                        <h3 class="card-title">Cadena de Markov: Distribuci√≥n Estacionaria</h3>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 1.5rem 0;">
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div class="metric-label">Estado: √âxito</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--success); margin: 0.5rem 0;">49.6%</div>
                            <p style="font-size: 0.85rem; color: var(--neutral);">Casi mitad de probabilidad</p>
                        </div>
                        <div style="background: rgba(251, 191, 36, 0.1); padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div class="metric-label">Estado: Estable</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--accent); margin: 0.5rem 0;">31.9%</div>
                            <p style="font-size: 0.85rem; color: var(--neutral);">Estado intermedio</p>
                        </div>
                        <div style="background: rgba(239, 68, 68, 0.1); padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div class="metric-label">Estado: Crisis</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: var(--warning); margin: 0.5rem 0;">11.9%</div>
                            <p style="font-size: 0.85rem; color: var(--neutral);">Transitorio</p>
                        </div>
                        <div style="background: rgba(127, 29, 29, 0.3); padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div class="metric-label">Estado: Colapso</div>
                            <div style="font-size: 2.5rem; font-weight: 900; color: #dc2626; margin: 0.5rem 0;">6.5%</div>
                            <p style="font-size: 0.85rem; color: var(--neutral);">Fracaso total</p>
                        </div>
                    </div>

                    <div class="insight-box">
                        <div class="insight-title">üí° Interpretaci√≥n</div>
                        <p style="color: var(--text); margin-bottom: 1rem;">
                            <strong>P(Crisis ‚à™ Colapso) = 18.4%</strong> ‚Üí 1 en 5.4 probabilidades de terminar en crisis o colapso.
                        </p>
                        <p style="color: var(--text);">
                            Sin embargo, probabilidad de √©xito tambi√©n es ~50%. Esto confirma naturaleza <strong>bimodal</strong>
                            del sistema: tiende a extremos. El momentum inicial es cr√≠tico.
                        </p>
                    </div>
                </div>

                <!-- Optimizaci√≥n -->
                <div id="optimization-viz" class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <span class="card-icon">üéØ</span>
                        <h3 class="card-title">Mix √ìptimo de Pol√≠ticas (SLSQP)</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="optimizationChart"></canvas>
                    </div>
                    <div class="insight-box" style="margin-top: 1.5rem;">
                        <div class="insight-title">Paradoja del Mix √ìptimo</div>
                        <p style="color: var(--text);">
                            En escenario base, la optimizaci√≥n matem√°tica recomienda <strong>Pensiones al 88%</strong>
                            (prioridad #2) y <strong>Salud al 0%</strong>, contradiciendo prioridades ciudadanas.
                            Raz√≥n: optimizaci√≥n privilegia pol√≠ticas con alta probabilidad √ó alto costo, no por m√©rito.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 4: CONCLUSIONES -->
        <div class="tab-content" id="conclusions">
            <div class="card" style="grid-column: 1 / -1;">
                <div class="card-header">
                    <span class="card-icon">üéØ</span>
                    <h3 class="card-title">Conclusiones Integradas</h3>
                </div>

                <div class="insight-box">
                    <div class="insight-title">1. Viabilidad del Programa</div>
                    <p style="color: var(--text); margin-bottom: 1rem;">
                        El programa es <strong>fiscalmente sostenible</strong> (d√©ficit <5% en todos los escenarios),
                        PERO esta sostenibilidad se debe a que la <strong>baja viabilidad pol√≠tica impide el gasto</strong>.
                    </p>
                    <p style="color: var(--text);">
                        <strong>Paradoja:</strong> El programa no colapsa fiscalmente porque nunca se implementa.
                        En escenario restrictivo, solo se gasta $517M de $7,050M planeados (7.3%).
                    </p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">2. Inestabilidad Sist√©mica</div>
                    <p style="color: var(--text); margin-bottom: 1rem;">
                        <strong>Sistema INESTABLE</strong> (Œª=1.620>1): NO existe equilibrio estable.
                    </p>
                    <ul style="list-style: none; padding-left: 0; color: var(--text);">
                        <li style="margin: 0.5rem 0;">‚úì Probabilidad de √©xito: ~50% si condiciones iniciales favorables</li>
                        <li style="margin: 0.5rem 0;">‚úó Probabilidad de crisis/colapso: 18.4% si encuentra resistencia</li>
                        <li style="margin: 0.5rem 0;">‚ö† Estados intermedios son transitorios</li>
                    </ul>
                </div>

                <div class="insight-box">
                    <div class="insight-title">3. Efectos Cruzados Destructivos</div>
                    <p style="color: var(--text); margin-bottom: 1rem;">
                        <strong>Pensiones ‚Üí Salud: -0.70</strong> (mayor efecto negativo del sistema)
                    </p>
                    <p style="color: var(--text);">
                        Implementar reforma de pensiones y salud simult√°neamente es <strong>mutuamente destructivo</strong>.
                        La presi√≥n fiscal de pensiones desfinancia salud severamente.
                    </p>
                </div>

                <div class="insight-box">
                    <div class="insight-title">4. Probabilidades de √âxito por Escenario</div>
                    <table class="comparison-table" style="margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th>Escenario</th>
                                <th>Viabilidad</th>
                                <th>P(√âxito)</th>
                                <th>Interpretaci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Optimista</strong></td>
                                <td>54%</td>
                                <td><span class="badge badge-medium">~50%</span></td>
                                <td>Coinflip - depende del momentum inicial</td>
                            </tr>
                            <tr>
                                <td><strong>Base</strong></td>
                                <td>24%</td>
                                <td><span class="badge badge-high">~25%</span></td>
                                <td>1 en 4 - logros limitados probables</td>
                            </tr>
                            <tr>
                                <td><strong>Restrictivo</strong></td>
                                <td>7%</td>
                                <td><span class="badge badge-critical">~5%</span></td>
                                <td>1 en 20 - fracaso casi seguro</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 2rem; padding: 2rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px; border: 2px solid var(--primary);">
                    <h3 style="color: var(--accent); margin-bottom: 1rem; font-size: 1.3rem;">üìã Conclusi√≥n Final</h3>
                    <p style="color: var(--text); line-height: 1.8;">
                        La matem√°tica NO dice si el programa es "bueno" o "malo" normativamente, pero S√ç cuantifica:
                    </p>
                    <ul style="list-style: none; padding-left: 0; color: var(--text); margin-top: 1rem;">
                        <li style="margin: 0.8rem 0;">‚Üí Probabilidades de √©xito: 5-50% seg√∫n escenario</li>
                        <li style="margin: 0.8rem 0;">‚Üí Sistema inherentemente inestable (tiende a extremos)</li>
                        <li style="margin: 0.8rem 0;">‚Üí Trade-offs ocultos severos entre pol√≠ticas clave</li>
                        <li style="margin: 0.8rem 0;">‚Üí Sostenibilidad fiscal parad√≥jica (por baja implementaci√≥n)</li>
                        <li style="margin: 0.8rem 0;">‚Üí Mix √≥ptimo difiere significativamente del programa propuesto</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer style="text-align: center; padding: 2rem; margin-top: 3rem; border-top: 2px solid rgba(59, 130, 246, 0.2); font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--neutral);">
            <p>An√°lisis Integral v2.0 | Metodolog√≠a: Simulaci√≥n + Sesgo + Matem√°tica Avanzada</p>
            <p style="margin-top: 0.5rem; font-size: 0.75rem;">Este an√°lisis es descriptivo, no prescriptivo</p>
        </footer>
    </div>

    <script>
        // Sistema de tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });

        // Datos base
        const baseData = {
            pibChile2025: 335000,
            deficitEstructural: 2.8,
            recaudacionTributaria: 21.2
        };

        let simParams = {
            cooperacionLeg: 50,
            crecimientoPIB: 2.5,
            presionFiscal: 65,
            movilizacionSocial: 45,
            capacidadEstatal: 55,
            apoyoInternacional: 60
        };

        // Configurar sliders
        const sliders = {
            'coop-slider': 'cooperacionLeg',
            'gdp-slider': 'crecimientoPIB',
            'fiscal-slider': 'presionFiscal',
            'social-slider': 'movilizacionSocial',
            'capacity-slider': 'capacidadEstatal',
            'intl-slider': 'apoyoInternacional'
        };

        Object.entries(sliders).forEach(([sliderId, paramName]) => {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(sliderId.replace('-slider', '-value'));
            
            slider.addEventListener('input', (e) => {
                let value = parseFloat(e.target.value);
                simParams[paramName] = value;
                
                if (paramName === 'crecimientoPIB') {
                    valueDisplay.textContent = value.toFixed(1) + '%';
                } else {
                    valueDisplay.textContent = Math.round(value) + '%';
                }
            });
        });

        // Funciones matem√°ticas
        function politicalViability(coop, mob, cap, intl) {
            const z = (0.4 * coop - 0.3 * Math.pow(mob, 1.5) / 100 + 0.2 * cap + 0.1 * intl - 0.15 * coop * mob / 10000);
            return 1 / (1 + Math.exp(-z / 20));
        }

        function economicViability(gdp, fiscal) {
            return ((gdp + 2) / 8) * (1 - Math.pow(fiscal / 100, 2));
        }

        // Simulaci√≥n Monte Carlo
        function runMonteCarloSimulation(params, n = 1000) {
            const results = {
                gdp: [],
                deficit: [],
                approval: []
            };

            for (let i = 0; i < n; i++) {
                const shockGdp = (Math.random() - 0.5) * 1.6;
                const shockPol = (Math.random() - 0.5) * 10;
                
                const gdp = params.crecimientoPIB + shockGdp;
                const coop = Math.max(0, Math.min(100, params.cooperacionLeg + shockPol));
                
                const viabPol = politicalViability(coop, params.movilizacionSocial, params.capacidadEstatal, params.apoyoInternacional);
                const viabEcon = economicViability(gdp, params.presionFiscal);
                
                const totalCost = 4000 * viabPol * viabEcon;
                const deficit = baseData.deficitEstructural + (totalCost / baseData.pibChile2025 * 100);
                const approval = 25 + 35 * viabPol - 25 * (params.movilizacionSocial / 100);
                
                results.gdp.push(gdp);
                results.deficit.push(deficit);
                results.approval.push(approval);
            }

            return results;
        }

        // Funci√≥n de simulaci√≥n principal
        function runSimulation() {
            const loading = document.getElementById('loading');
            loading.classList.add('active');

            setTimeout(() => {
                const viabPol = politicalViability(
                    simParams.cooperacionLeg,
                    simParams.movilizacionSocial,
                    simParams.capacidadEstatal,
                    simParams.apoyoInternacional
                );

                const viabEcon = economicViability(
                    simParams.crecimientoPIB,
                    simParams.presionFiscal
                );

                const totalCost = 7050 * viabPol * viabEcon * 0.57;
                const deficit = baseData.deficitEstructural + (totalCost / baseData.pibChile2025 * 100);
                const impactoPIB = simParams.crecimientoPIB + 0.6 * viabPol - 0.4 * Math.pow(simParams.presionFiscal / 100, 2);
                const aprobacion = 25 + 35 * viabPol - 25 * (simParams.movilizacionSocial / 100);

                renderSimulationResults({
                    viabPol,
                    viabEcon,
                    totalCost,
                    deficit,
                    impactoPIB,
                    aprobacion
                });

                // Monte Carlo
                const mcResults = runMonteCarloSimulation(simParams, 1000);
                renderMonteCarloChart(mcResults);

                // Optimizaci√≥n
                renderOptimizationChart(viabPol, viabEcon);

                loading.classList.remove('active');
            }, 1500);
        }

        function renderSimulationResults(results) {
            const container = document.getElementById('simulation-results');
            
            container.innerHTML = `
                <div class="section">
                    <h2 class="section-title">
                        <span>üìä</span>
                        <span>Resultados de Simulaci√≥n</span>
                    </h2>

                    <div class="grid">
                        <div class="card">
                            <div class="card-header">
                                <span class="card-icon">üìà</span>
                                <h3 class="card-title">Viabilidades</h3>
                            </div>
                            <div class="metric">
                                <div class="metric-label">Viabilidad Pol√≠tica</div>
                                <div class="metric-value">${(results.viabPol * 100).toFixed(1)}%</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${results.viabPol * 100}%;"></div>
                                </div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">Viabilidad Econ√≥mica</div>
                                <div class="metric-value">${(results.viabEcon * 100).toFixed(1)}%</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${results.viabEcon * 100}%;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <span class="card-icon">üí∞</span>
                                <h3 class="card-title">Impactos Fiscales</h3>
                            </div>
                            <div class="metric">
                                <div class="metric-label">Costo Total Estimado</div>
                                <div class="metric-value">$${results.totalCost.toFixed(0)}<span style="font-size: 1rem; color: var(--neutral);">M USD</span></div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">D√©ficit Fiscal</div>
                                <div class="metric-value" style="color: ${results.deficit > 5 ? 'var(--warning)' : 'var(--success)'};">${results.deficit.toFixed(2)}<span style="font-size: 1rem; color: var(--neutral);">% PIB</span></div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <span class="card-icon">üìä</span>
                                <h3 class="card-title">Impactos Macroecon√≥micos</h3>
                            </div>
                            <div class="metric">
                                <div class="metric-label">PIB Growth Proyectado</div>
                                <div class="metric-value">${results.impactoPIB.toFixed(2)}<span style="font-size: 1rem; color: var(--neutral);">%</span></div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">Aprobaci√≥n Ciudadana</div>
                                <div class="metric-value">${Math.max(0, results.aprobacion).toFixed(1)}<span style="font-size: 1rem; color: var(--neutral);">%</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMonteCarloChart(results) {
            const ctx = document.getElementById('monteCarloChart');
            if (!ctx) return;

            // Crear histograma de PIB
            const gdpBins = createHistogram(results.gdp, 20);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: gdpBins.labels,
                    datasets: [{
                        label: 'Frecuencia',
                        data: gdpBins.values,
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Distribuci√≥n de Crecimiento PIB (1000 simulaciones)',
                            color: '#f1f5f9',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'PIB Growth (%)',
                                color: '#94a3b8'
                            },
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Frecuencia',
                                color: '#94a3b8'
                            },
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        function renderOptimizationChart(viabPol, viabEcon) {
            const ctx = document.getElementById('optimizationChart');
            if (!ctx) return;

            const policies = ['Seguridad', 'Pensiones', 'Salud', 'Empleo', 'Migraci√≥n', 'Educaci√≥n'];
            
            // Mix √≥ptimo simplificado basado en viabilidad
            let optimalMix;
            if (viabPol > 0.6 && viabEcon > 0.5) {
                optimalMix = [100, 0, 100, 100, 43, 32];
            } else if (viabPol > 0.4) {
                optimalMix = [100, 88, 0, 82, 48, 0];
            } else {
                optimalMix = [100, 33, 46, 100, 47, 35];
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: policies,
                    datasets: [{
                        label: 'Nivel √ìptimo de Implementaci√≥n (%)',
                        data: optimalMix,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(139, 92, 246, 0.6)',
                            'rgba(16, 185, 129, 0.6)',
                            'rgba(251, 191, 36, 0.6)',
                            'rgba(239, 68, 68, 0.6)',
                            'rgba(148, 163, 184, 0.6)'
                        ],
                        borderColor: [
                            'rgba(59, 130, 246, 1)',
                            'rgba(139, 92, 246, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(251, 191, 36, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(148, 163, 184, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Mix √ìptimo bajo Restricci√≥n Presupuestaria',
                            color: '#f1f5f9',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Nivel de Implementaci√≥n (%)',
                                color: '#94a3b8'
                            },
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        function createHistogram(data, bins) {
            const min = Math.min(...data);
            const max = Math.max(...data);
            const binWidth = (max - min) / bins;
            
            const counts = new Array(bins).fill(0);
            const labels = [];
            
            for (let i = 0; i < bins; i++) {
                labels.push((min + i * binWidth).toFixed(1));
            }
            
            data.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binWidth), bins - 1);
                counts[binIndex]++;
            });
            
            return { labels, values: counts };
        }

        // Ejecutar simulaci√≥n inicial
        document.getElementById('simulate-btn').addEventListener('click', runSimulation);
        runSimulation();
    </script>
</body>
</html>
